<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>speed match</title>
    <script src="js/cards.js"></script>
    <script src="js/control.js"></script>
    <script src="js/score.js"></script>
    <script src="js/initial.js"></script>
    <script src="js/stack.js"></script>
<!--    <script src="godb/godbManager.js"></script> todo Vue -->
    <script src="js/jquery.min.js"></script>
    <script src="layui/layui.js"></script>
    <link rel="stylesheet" type="text/css" href="layui/css/layui.css"/>
    <script src="bootstrap-3.4.1-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="bootstrap-3.4.1-dist/css/bootstrap.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"
            integrity="sha512-EmNxF3E6bM0Xg1zvmkeYD3HDBeGxtsG92IxFt1myNZhXdCav9MzvuH/zNMBU1DmIPN6njrhX1VTbqdJxQ2wHDg=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        .box{
            width: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            height: 50vh;
        }
        .cardModule{
            width: 200px;
            height: 200px;
            border: 1px solid white;
        }
    </style>
</head>
<body>
<audio id="notifyAudio" hidden="hidden">
    <source src="audio/notify.mp3" type="audio/mpeg">
    您的浏览器不支持 audio 与元素。
</audio>
<div class="container-fluid">
    <p style="text-align: center">通过键盘(不一致)←左右→(一致)键来判定后出现的图形是否跟前面的图形一致</p>
    <p style="text-align: center">请留意游戏开始前的第一个图形!</p>
    <div class="center-block" style="text-align:center;width: 300px;height: 20px;background-color: yellow"
         id="clock"></div>
<!--    <div class="center-block" style="text-align:center;width: 300px;height: 20px;background-color: yellow"-->
<!--         id="count"></div>-->
    <div class="center-block" style="text-align:center;width: 300px;height: 20px;background-color: yellow"
         id="continual"></div>
    <div class="center-block" style="text-align:center;width: 300px;height: 20px;background-color: yellow"
         id="level"></div>
    <div class="center-block" style="text-align:center;width: 300px;height: 20px;background-color: yellow"
         id="score"></div>
    <div class="box ws-docs-anim" id="cardBox">
    <div class="cardModule" style="width: 200px;height: 200px;" id="gone" onclick="window.open('http://8.136.81.58:3000/')"></div>
    <div class="layui-anim" data-anim="layui-anim-left" style="width: 200px;height: 200px;" id="save"></div>
    </div>
    <div id="chart" style="width:50%;min-height:300px">
    </div>

</div>
<script>
    // const notify_audio = document.getElementById('notifyAudio')

    var saveNode = document.getElementById("save");
    // var saveNode = $("#save");
    var goneNode = document.getElementById("gone");

    var continualNode = document.getElementById("continual");
    var levelNode = document.getElementById("level");
    var scoreNode = document.getElementById("score");

    //初始化今日牌堆
    var todayCardStack = initialCardsStack()
    //弹出的数值
    var popNb = null;
    //过去的数值
    var goneValue = null;

    //分数相关
    var continualNb = 0;
    var scoreLevel = 1;
    var baseScore = 50;
    var allScore = 0;

    //展示卡牌堆顶
    showSave(todayCardStack.peek())

    //计时
    clock()
    var scoreFlag = null;

    var gameBegin = false;
    function animFunc(ele){
        var othis = $(ele), anim = othis.data('anim');

        //停止循环
        if(othis.hasClass('layui-anim-loop')){
            return othis.removeClass(anim);
        }

        othis.removeClass(anim);

        setTimeout(function(){
            othis.addClass(anim);
        });
        //恢复渐隐
        if(anim === 'layui-anim-fadeout'){
            setTimeout(function(){
                othis.removeClass(anim);
            }, 1300);
        }
    }

    layui.use(function(){
        var layer = layui.layer;
        var $ = layui.$;
        //演示动画
        // $('.ws-docs-anim .layui-anim').on('click', function(){
        //     animFunc(saveNode)
        // });
        layer.tips('点击logo访问作者最新开源成果', goneNode, {
            tips: 4,
            time:20000
        });
        let countDownAlert = layer.alert('通过键盘(不一致)←左右→(一致)键来判定后出现的图形是否跟前面的图形一致，<br>请留意游戏开始前的第一个图形!', {
            time: 5*1000,
            btn:'现在开始',
            success: function(layero, index){
                var timeNum = this.time/1000, setText = function(start){
                    layer.title('<span class="layui-font-red">'+ (start ? timeNum : --timeNum) + '</span> 秒后自动开始', index);
                };
                setText(!0);
                this.timer = setInterval(setText, 1000);
                if(timeNum <= 0) clearInterval(this.timer);
            },
            end: function(){
                clearInterval(this.timer);
                gameBegin=true
                cardPop()
            },
            yes:function(){
                clearInterval(this.timer);
                layer.close(countDownAlert)
                gameBegin=true
            },
            offset: [$(window).height() - 700, $(window).width() - 1090]
        });

        // if (navigator.geolocation) {
        //     navigator.geolocation.getCurrentPosition(function(position) {
        //         var latitude = position.coords.latitude; // 经度
        //         var longitude = position.coords.longitude; // 纬度
        //
        //         console.log("当前用户所在位置的经度为：" + latitude);
        //         console.log("当前用户所在位置的纬度为：" + longitude);
        //     });
        // } else {
        //     console.log('Geolocation is not supported by this browser');
        // }
    //监听键盘 并翻牌
    $(document).keydown(function (event) {
        if(!gameBegin){return}
        if (event.keyCode === 37) {
            animFunc(saveNode)
            // notify_audio.play();
            console.log('你按下了left arrow');
            let cent = judgementLeft()
            if (cent>0){
                layer.msg('correct～～:)',{ offset: [$(window).height() - 500, $(window).width() - 1000] })
                continualNb+=cent
                scoreFlag =1;
                calculateScore();
            }else{
                layer.msg('wrong！:(',{ offset: [$(window).height() - 500, $(window).width() - 1000] })
                continualNb=0;
                scoreLevel==1?scoreLevel=1:scoreLevel--;
                scoreFlag = 0;
            }
            cardPop()
        }
        if (event.keyCode === 39) {
            animFunc(saveNode)
            // notify_audio.play();
            console.log('你按下了right arrow');
            let cent = judgementRight()
            if (cent>0){
                layer.msg('correct～～:)',{ offset: [$(window).height() - 500, $(window).width() - 1000] })
                continualNb+=cent
                scoreFlag = 1;
                calculateScore();
            }else{
                layer.msg('wrong！:(',{ offset: [$(window).height() - 500, $(window).width() - 1000] })
                continualNb=0;
                scoreLevel==1?scoreLevel=1:scoreLevel--;
                scoreFlag= 0;
            }
            cardPop()
        }
        if(continualNb===0){
            console.log("score level will be decrease")
        }else{
            if (continualNb%4.0===0){
                scoreLevel++;
                console.log("new score level:"+scoreLevel)
            }
        }
        //163900
    });
    });
    function calculateScore(){
        //分数基数50
        allScore += scoreLevel*baseScore*scoreFlag;
        continualNode.innerText="连续答对数量:"+continualNb
        scoreNode.innerText="全部分数:"+allScore
        levelNode.innerText="分数等级:"+scoreLevel
        console.log("continualNb:"+continualNb)
        console.log("scoreLevel:"+scoreLevel)
    }


    function generateData() {
        adjustmentGaussianLikeLength()
        let data = [];
        for(var i=repeatContinuous.length-1;i>=0;i--){
            if(i!==0){
                data.push([-i,repeatContinuous[i]])
            }else if(i===0){
                data.push([i,repeatContinuous[i]])
            }
        }
        for(var i=0;i<repeatContinuous.length;i++){
            if(i!==0){
                data.push([i,repeatContinuous[i]])
            }
        }
        console.log('data ',data)
        return data;
    }

    function standardGaussianRatio(){
        adjustmentGaussianLikeLength()
        let data = [];
        for(var i=gaussianDistribution.length-1;i>=0;i--){
            if(i!==0){
                data.push([-i,gaussianDistribution[i]])
            }else if(i===0){
                data.push([i,gaussianDistribution[i]])
            }
        }
        for(var i=0;i<gaussianDistribution.length;i++){
            if(i!==0){
                data.push([i,gaussianDistribution[i]])
            }
        }
        return data;
    }


    var myChart = echarts.init(document.getElementById("chart"));
    myChart.showLoading();

    optionOfGaussian = {
        title: {
            text: '重复率'
        },
        legend: {
            data: ['重复率分布', '标准正态分布']
        },
        animation: false,
        grid: {
            top: 40,
            left: 50,
            right: 40,
            bottom: 50
        },
        xAxis: {
            name: 'x',
            minorTick: {
                show: true
            },
            minorSplitLine: {
                show: true
            }
        },
        yAxis: {
            name: 'y',
            min: -100,
            max: 100,
            minorTick: {
                show: true
            },
            minorSplitLine: {
                show: true
            }
        },
        dataZoom: [
            {
                show: true,
                type: 'inside',
                filterMode: 'none',
                xAxisIndex: [0],
                startValue: -20,
                endValue: 20
            },
            {
                show: true,
                type: 'inside',
                filterMode: 'none',
                yAxisIndex: [0],
                startValue: 0,
                endValue: 50
            }
        ],
        series: [
            {
                name:'重复率分布',
                type: 'line',
                showSymbol: false,
                clip: true,
                data: generateData()
            },
            {
                name: '标准正态分布',
                type: 'line',
                showSymbol: false,
                clip: true,
                data: standardGaussianRatio()
            }
        ]
    };

    myChart.setOption(optionOfGaussian);
    myChart.hideLoading();





</script>

</body>
</html>
